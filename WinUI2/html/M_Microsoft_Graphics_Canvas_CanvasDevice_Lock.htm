<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>CanvasDevice.Lock Method </title><meta name="Language" content="en-us" /><meta name="System.Keywords" content="Lock method" /><meta name="System.Keywords" content="CanvasDevice.Lock method" /><meta name="Microsoft.Help.F1" content="Microsoft.Graphics.Canvas.CanvasDevice.Lock" /><meta name="Microsoft.Help.Id" content="M:Microsoft.Graphics.Canvas.CanvasDevice.Lock" /><meta name="Description" content="Locks the device for the current thread." /><meta name="Microsoft.Help.ContentType" content="Reference" /><meta name="BrandingAware" content="true" /><meta name="container" content="Microsoft.Graphics.Canvas" /><meta name="file" content="M_Microsoft_Graphics_Canvas_CanvasDevice_Lock" /><meta name="guid" content="M_Microsoft_Graphics_Canvas_CanvasDevice_Lock" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Win2D documentation<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="Introduction.htm" title="Win2D documentation" tocid="roottoc">Win2D documentation</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="APIReference.htm" title="API Reference" tocid="APIReference">API Reference</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="N_Microsoft_Graphics_Canvas.htm" title="Microsoft.Graphics.Canvas" tocid="N_Microsoft_Graphics_Canvas">Microsoft.Graphics.Canvas</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="T_Microsoft_Graphics_Canvas_CanvasDevice.htm" title="CanvasDevice Class" tocid="T_Microsoft_Graphics_Canvas_CanvasDevice">CanvasDevice Class</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="Methods_T_Microsoft_Graphics_Canvas_CanvasDevice.htm" title="CanvasDevice Methods" tocid="Methods_T_Microsoft_Graphics_Canvas_CanvasDevice">CanvasDevice Methods</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_Microsoft_Graphics_Canvas_CanvasDevice_CreateFromDirect3D11Device.htm" title="CreateFromDirect3D11Device Method " tocid="M_Microsoft_Graphics_Canvas_CanvasDevice_CreateFromDirect3D11Device">CreateFromDirect3D11Device Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_Microsoft_Graphics_Canvas_CanvasDevice_Dispose.htm" title="Dispose Method " tocid="M_Microsoft_Graphics_Canvas_CanvasDevice_Dispose">Dispose Method </a></div><div class="toclevel2" data-toclevel="2"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="Overload_Microsoft_Graphics_Canvas_CanvasDevice_GetSharedDevice.htm" title="GetSharedDevice Method " tocid="Overload_Microsoft_Graphics_Canvas_CanvasDevice_GetSharedDevice">GetSharedDevice Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_Microsoft_Graphics_Canvas_CanvasDevice_IsBufferPrecisionSupported.htm" title="IsBufferPrecisionSupported Method " tocid="M_Microsoft_Graphics_Canvas_CanvasDevice_IsBufferPrecisionSupported">IsBufferPrecisionSupported Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_Microsoft_Graphics_Canvas_CanvasDevice_IsDeviceLost.htm" title="IsDeviceLost Method " tocid="M_Microsoft_Graphics_Canvas_CanvasDevice_IsDeviceLost">IsDeviceLost Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_Microsoft_Graphics_Canvas_CanvasDevice_IsPixelFormatSupported.htm" title="IsPixelFormatSupported Method " tocid="M_Microsoft_Graphics_Canvas_CanvasDevice_IsPixelFormatSupported">IsPixelFormatSupported Method </a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="M_Microsoft_Graphics_Canvas_CanvasDevice_Lock.htm" title="Lock Method " tocid="M_Microsoft_Graphics_Canvas_CanvasDevice_Lock">Lock Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_Microsoft_Graphics_Canvas_CanvasDevice_RaiseDeviceLost.htm" title="RaiseDeviceLost Method " tocid="M_Microsoft_Graphics_Canvas_CanvasDevice_RaiseDeviceLost">RaiseDeviceLost Method </a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="M_Microsoft_Graphics_Canvas_CanvasDevice_Trim.htm" title="Trim Method " tocid="M_Microsoft_Graphics_Canvas_CanvasDevice_Trim">Trim Method </a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn">CanvasDevice<span id="LST641262E1_0"></span><script type="text/javascript">AddLanguageSpecificTextSet("LST641262E1_0?cpp=::|nu=.");</script>Lock Method </td></tr></table><span class="introStyle"></span> <div class="summary">Locks the device for the current thread.</div><p> </p>
    <strong>Namespace:</strong> 
   <a href="N_Microsoft_Graphics_Canvas.htm">Microsoft.Graphics.Canvas</a><br />
    <strong>Assembly:</strong>
   Microsoft.Graphics.Canvas (in Microsoft.Graphics.Canvas.dll) Version: 0.0.0.0<div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Syntax</span></div><div id="ID1RBSection" class="collapsibleSection"><div class="codeSnippetContainer"><div class="codeSnippetContainerTabs"><div id="ID0EACA_tab1" class="codeSnippetContainerTabSingle">C#</div></div><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EACA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EACA');return false;" title="Copy">Copy</a></div></div><div id="ID0EACA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="keyword">public</span> <span class="identifier">CanvasLock</span> <span class="identifier">Lock</span>()</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EACA");</script><h4 class="subHeading">Return Value</h4>Type: <a href="T_Microsoft_Graphics_Canvas_CanvasLock.htm">CanvasLock</a></div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Remarks</span></div><div id="ID2RBSection" class="collapsibleSection"><p>
          If your application does not use multiple threads or Direct2D interop
          and only uses the default devices created by CanvasControl or
          CanvasAnimatedControl then you do not need to worry about any of the
          following!
        </p><p>
          Win2D takes care to ensure that methods on its API can be called from
          any thread.  However, when sharing resources with non-Win2D APIs
          (using <a href="Interop.htm">Direct2D interop</a> or the interfaces
          from <a href="https://msdn.microsoft.com/library/windows/apps/Windows.Graphics.DirectX.Direct3D11">Windows.Graphics.DirectX.Direct3D11</a>
          for example) it is important to ensure these resources are only ever
          accessed from a single thread at a time.
        </p><p>
          This method allows you to take out a lock on the CanvasDevice so that
          only the current thread is able to access any Win2D resources created
          from that device.  The returned object holds the lock until it is
          disposed.
        </p><p>
          For example, <a href="https://msdn.microsoft.com/en-us/library/windows/apps/dn891449.aspx">SoftwareBitmap.CreateCopyFromSurfaceAsync</a>
          takes a reference to an <a href="https://msdn.microsoft.com/en-us/library/windows/apps/windows.graphics.directx.direct3d11.idirect3dsurface.aspx">IDirect3DSurface</a>.
          Since SoftwareBitmap is not a part of Win2D it does not know that it
          needs to use Win2D's lock when accessing the surface.  If the
          application had another thread running then these could both be
          accessing the underlying graphics device simultaneously.  This code
          shows how to do this correctly:

          <div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EABCABA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EABCABA');return false;" title="Copy">Copy</a></div></div><div id="ID0EABCABA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">SoftwareBitmap softwareBitmap;
<span class="highlight-keyword">using</span> (<span class="highlight-keyword">var</span> <span class="highlight-keyword">lock</span> = canvasBitmap.Device.Lock())
{
    softwareBitmap = <span class="highlight-keyword">await</span> SoftwareBitmap.CreateCopyFromSurfaceAsync(canvasBitmap);
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EABCABA");</script>
          
          If you are programming in C++/CX, the 'delete' keyword should be used to release the lock object.
        </p><p>
          Win2D is built on top of Direct2D, and inherits the threading model
          from there.  The <a HREF="https://msdn.microsoft.com/en-us/library/windows/desktop/jj569217(v=vs.85).aspx">MSDN</a>
          documentation can provide additional insight beyond the quick overview
          here.
        </p><p>
          In Direct2D terms,
          <span class="selflink">CanvasDevice.Lock</span>
          calls
          <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/hh997714(v=vs.85).aspx">ID2D1MultiThread::Enter</a>
          and <a href="M_Microsoft_Graphics_Canvas_CanvasLock_Dispose.htm">CanvasLock.Dispose</a>
          calls
          <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/hh997716(v=vs.85).aspx">ID2D1MultiThread::Leave</a>.
        </p></div><div class="collapsibleAreaRegion" id="seeAlsoSection"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />See Also</span></div><div id="ID3RBSection" class="collapsibleSection"><h4 class="subHeading">Reference</h4><div class="seeAlsoStyle"><a href="T_Microsoft_Graphics_Canvas_CanvasDevice.htm">CanvasDevice Class</a></div><div class="seeAlsoStyle"><a href="N_Microsoft_Graphics_Canvas.htm">Microsoft.Graphics.Canvas Namespace</a></div></div></div></div><div id="pageFooter" class="pageFooter"><p><a href="http://github.com/Microsoft/Win2D/blob/master/LICENSE.txt" target="_blank">Copyright (c) Microsoft Corporation. All rights reserved.</a></p> </div></body></html>