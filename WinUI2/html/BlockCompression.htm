<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Bitmap block compression</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="BlockCompression" /><meta name="Description" content="CanvasBitmap supports block compressed bitmaps. These can be loaded from a DDS file, or created with M:Microsoft.Graphics.Canvas.CanvasBitmap.CreateFromBytes(Microsoft.Graphics.Canvas.ICanvasResourceCreator,System.Byte[],System.Int32,System.Int32,Windows." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Win2D documentation<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="Introduction.htm" title="Win2D documentation" tocid="roottoc">Win2D documentation</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="Articles.htm" title="Articles" tocid="Articles">Articles</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="Interop.htm" title="Interop with Direct2D" tocid="Interop">Interop with Direct2D</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="Offscreen.htm" title="Offscreen drawing" tocid="Offscreen">Offscreen drawing</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="DPI.htm" title="DPI and DIPs" tocid="DPI">DPI and DIPs</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="ChoosingResolution.htm" title="Choosing control resolution" tocid="ChoosingResolution">Choosing control resolution</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="PixelFormats.htm" title="Pixel formats" tocid="PixelFormats">Pixel formats</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="PremultipliedAlpha.htm" title="Premultiplied alpha" tocid="PremultipliedAlpha">Premultiplied alpha</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="BlockCompression.htm" title="Bitmap block compression" tocid="BlockCompression">Bitmap block compression</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="EffectPrecision.htm" title="Effect precision and clamping" tocid="EffectPrecision">Effect precision and clamping</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="HandlingDeviceLost.htm" title="Handling device lost" tocid="HandlingDeviceLost">Handling device lost</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="WithoutControls.htm" title="Using Win2D without built-in controls" tocid="WithoutControls">Using Win2D without built-in controls</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="LoadingResourcesOutsideCreateResources.htm" title="Loading resources outside of CreateResources" tocid="LoadingResourcesOutsideCreateResources">Loading resources outside of CreateResources</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="RefCycles.htm" title="Avoiding memory leaks" tocid="RefCycles">Avoiding memory leaks</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn">Bitmap block compression</td></tr></table><span class="introStyle"></span> <div class="introduction"><p>
        CanvasBitmap supports block compressed bitmaps.  These can be loaded
        from a DDS file, or created with
        <a href="M_Microsoft_Graphics_Canvas_CanvasBitmap_CreateFromBytes.htm">CreateFromBytes(ICanvasResourceCreator, <span id="LSTBD2773CB_0"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTBD2773CB_0?cpp=array&lt;");</script>Byte<span id="LSTBD2773CB_1"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTBD2773CB_1?cpp=&gt;|cs=[]|vb=()|nu=[]|fs=[]");</script>, Int32, Int32, DirectXPixelFormat)</a>.
      </p><p>
        Block compressed bitmaps are great for bitmap heavy applications (such
        as games) because they take up less memory and can be drawn more
        efficiently.  A block compressed bitmap uses up to 1/8th of the memory
        of an uncompressed bitmap.  As a result, the GPU needs to access much
        less memory when drawing the bitmap, resulting in faster drawing.
      </p></div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID0RB')" onkeypress="SectionExpandCollapse_CheckKey('ID0RB', event)" tabindex="0"><img id="ID0RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />About Block Compression</span></div><div id="ID0RBSection" class="collapsibleSection"><p>
          Block compression is different to the compression employed by PNG or
          JPG files.  Compressed file formats are stored compressed but when
          they are loaded by Win2D they are decompressed into a bitmap with a
          format such as DirectXPixelFormat::B8G8R8A8UIntNormalized, which uses
          32 bits (4 bytes) per pixel.  So a 256x256 bitmap would take up 256 *
          256 * 4 = 262,144 bytes.
        </p><p>
          A block compressed bitmap uses 8 or 16 bytes (depending on the format
          -- more on this later) to store a block of 4x4 pixels.  So in this
          case a 256x256 bitmap would take up 256 * 256 / (4*4) * 8 = 32,768
          bytes, or 256 * 256 / (4*4) * 16 = 65,536 bytes.  That's up to 8 times
          smaller!  Since block compression is supported directly by the GPU
          hardware, the bitmap can be kept compressed in memory and drawn
          directly from the compressed format without ever having to completely
          uncompress it.
        </p><p>
          Win2D supports three block compressed formats.  The table below
          describes these formats, along with an uncompressed format for
          comparison.
          <div class="tableSection"><table><tr><th>DirectXPixelFormat</th><th>Size of 4x4 bitmap</th><th>Size of 256x256 bitmap</th><th>Alpha</th></tr><tr><td>BC1Unorm</td><td>8 bytes</td><td>32,768 bytes</td><td>1 bit</td></tr><tr><td>BC2Unorm</td><td>16 bytes</td><td>65,536 bytes</td><td>4 bit</td></tr><tr><td>BC3Unorm</td><td>16 bytes</td><td>65,536 bytes</td><td>~8 bit (compressed)</td></tr><tr><td>B8G8R8A8UintNormalized</td><td>64 bytes</td><td>262,144 bytes</td><td>8 bit</td></tr></table></div>
          BC1Unorm, BC2Unorm and BC3Unorm differ mostly in how they support
          alpha.  BC1 supports only 1-bit alpha.  BC2 supports each pixel in the
          block having a unique 4-bit alpha value.  BC3 compresses the alpha
          values.
        </p><p>
          See
          <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dn424084(v=vs.85).aspx" target="_blank">Direct2D Block Compression documentation</a>
          and
          <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/bb694531(v=vs.85).aspx" target="_blank">Direct3D Block Compression documentation</a>
          for more information about how block compression works.
        </p></div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Restrictions</span></div><div id="ID1RBSection" class="collapsibleSection"><ul><li>
            All block compressed textures must have a width and height that is a
            multiple of 4.  This is because block compression works on blocks of
            4x4 pixels.
          </li><li>
            Any operation on a sub-rectangle of a block compressed texture
            (using
            <a href="M_Microsoft_Graphics_Canvas_CanvasBitmap_GetPixelBytes.htm">GetPixelBytes<span id="LSTBD2773CB_2"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTBD2773CB_2?cs=()|vb=|cpp=()|nu=()|fs=()");</script></a>,
            <a href="M_Microsoft_Graphics_Canvas_CanvasBitmap_SetPixelBytes.htm">SetPixelBytes(<span id="LSTBD2773CB_3"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTBD2773CB_3?cpp=array&lt;");</script>Byte<span id="LSTBD2773CB_4"></span><script type="text/javascript">AddLanguageSpecificTextSet("LSTBD2773CB_4?cpp=&gt;|cs=[]|vb=()|nu=[]|fs=[]");</script>)</a>,
            <a href="M_Microsoft_Graphics_Canvas_CanvasBitmap_CopyPixelsFromBitmap_1.htm">CopyPixelsFromBitmap(CanvasBitmap, Int32, Int32)</a>)
            require that the sub-rectangle is 4-pixel aligned.
          </li><li>
            Win2D requires premultiplied alpha when using block compressed
            formats.
          </li></ul></div><div class="collapsibleAreaRegion"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID3RB')" onkeypress="SectionExpandCollapse_CheckKey('ID3RB', event)" tabindex="0"><img id="ID3RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Authoring DDS files</span></div><div id="ID3RBSection" class="collapsibleSection"><p>
          Block compressed images can be saved in DDS files.  Although these can
          be generated by plugins to applications such as Photoshop or
          Paint.NET, care must be taken to ensure that the resulting file is
          saved with premultiplied alpha.  Win2D will load any DDS file
          containing a BC1Unorm, BC2Unorm or BC3Unorm image and assume that it
          is authored with premultiplied alpha.
        </p><p>
          If you are authoring a C++ project then you can use the Image Content
          Pipeline to convert the image, as described on
          <a href="https://msdn.microsoft.com/library/dn392693(v=vs.140).aspx" target="_blank">MSDN</a>.
        </p><p>
          Alternatively, you can use texconv.exe from
          <a href="https://github.com/Microsoft/DirectXTex" target="_blank">https://github.com/Microsoft/DirectXTex</a>.  texconv.exe can be built using the DirectXTex_Desktop_2015.sln
          solution.  The following command converts "smoke.png" to a BC3Unorm
          with premultiplied alpha:
          <div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID2EAAAAAAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID2EAAAAAAAA');return false;" title="Copy">Copy</a></div></div><div id="ID2EAAAAAAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve">texconv -pmalpha -m <span class="highlight-number">1</span> -f BC3_UNORM smoke.png</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID2EAAAAAAAA");</script></p></div></div></div><div id="pageFooter" class="pageFooter"><p><a href="http://github.com/Microsoft/Win2D/blob/master/LICENSE.txt" target="_blank">Copyright (c) Microsoft Corporation. All rights reserved.</a></p></div></body></html>